{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2019-05-22---introduction-to-promise/","webpackCompilationHash":"e9cc243cc93db75b9fd4","result":{"data":{"site":{"siteMetadata":{"title":"Today I Learned","author":"Waiyan Yoon"}},"markdownRemark":{"id":"3070471c-79a4-5514-ba57-c90287405f87","excerpt":"promises So you’ve clicked the title to read this post. I know you’re a JavaScript developer by then. You’ve probably seen “promise” and “async / await” flying…","html":"<p><img src=\"/javascript_promises-4ad8f5ee99a2260bc59a6af886dba5c6.svg\" alt=\"promises\"></p>\n<p>So you’ve clicked the title to read this post. I know you’re a JavaScript developer by then. You’ve probably seen “promise” and “async / await” flying everywhere in Medium and blog posts written by developers with at least a slight of knowledge about it. There’s a big chance that you’ve been using Promise all this while with the mind of “it just works” without knowing the reason behind the <code class=\"language-text\">.then</code> chain.\nIn this post, we’ll discover a little bit of history behind Promise, by implementing a couple of API calls to Github to retrieve a user’s profile and repositories.\nIf you’re a seasoned developer for years, you’ve probably attempted this at some point in your career:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">username</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://api.github.com/users/\"</span> <span class=\"token operator\">+</span> username<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">userError<span class=\"token punctuation\">,</span>\n    userReponse<span class=\"token punctuation\">,</span>\n    user</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://api.github.com/users/\"</span> <span class=\"token operator\">+</span> username <span class=\"token operator\">+</span> <span class=\"token string\">\"/repos\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n      <span class=\"token parameter\">reposError<span class=\"token punctuation\">,</span>\n      reposResponse<span class=\"token punctuation\">,</span>\n      repos</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"repos\"</span><span class=\"token punctuation\">,</span> repos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">,</span> repos<span class=\"token punctuation\">:</span> repos <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> repos<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Getting value from a function that calls API asynchronously is not an easy task. This is the value returned by calling the function above:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> userInfo <span class=\"token operator\">=</span> <span class=\"token function\">getInfo</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gaearon\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>userInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// returns { user: null, repos: [] }</span></code></pre></div>\n<p>Due to the asynchronous nature of JavaScript language, the API calls are not handled by <code class=\"language-text\">getUser</code> function. At this point, maybe you’ll try to a callback to assign a variable within the callback function:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getUserWithCallback</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">username<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://api.github.com/users/\"</span> <span class=\"token operator\">+</span> username<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">userError<span class=\"token punctuation\">,</span>\n    userReponse<span class=\"token punctuation\">,</span>\n    user</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://api.github.com/users/\"</span> <span class=\"token operator\">+</span> username <span class=\"token operator\">+</span> <span class=\"token string\">\"/repos\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n      <span class=\"token parameter\">reposError<span class=\"token punctuation\">,</span>\n      reposResponse<span class=\"token punctuation\">,</span>\n      repos</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"repos\"</span><span class=\"token punctuation\">,</span> repos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      \n      <span class=\"token keyword\">var</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">,</span> repos<span class=\"token punctuation\">:</span> repos <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      \n      <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> repos<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> callbackUserInfo<span class=\"token punctuation\">;</span>\n<span class=\"token function\">callbackGetUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yoonwaiyan\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">userInfo</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  callbackUserInfo <span class=\"token operator\">=</span> userInfo<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"callbackUserInfo\"</span><span class=\"token punctuation\">,</span> callbackUserInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// undefined</span></code></pre></div>\n<p>Now, the <code class=\"language-text\">callbackGetUser</code> process is way out of space and there’s no way to catch it back and <code class=\"language-text\">console.log</code> merely tells you it went missing. You might think that callback works, but <strong>declaring a function with a callback argument won’t make it asynchronous</strong>. <a href=\"https://stackoverflow.com/questions/19083357/are-all-javascript-callbacks-asynchronous-if-not-how-do-i-know-which-are\">See here for more info</a></p>\n<p>If you’re in a hurry to get this call working, you’ll probably remove the function altogether and resort in the main call instead:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> userInfo<span class=\"token punctuation\">,</span> userRepos<span class=\"token punctuation\">;</span>\n<span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://api.github.com/users/\"</span> <span class=\"token operator\">+</span> username<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\">userError<span class=\"token punctuation\">,</span>\n  userReponse<span class=\"token punctuation\">,</span>\n  user</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  userInfo <span class=\"token operator\">=</span> user<span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userInfo\"</span><span class=\"token punctuation\">,</span> userInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://api.github.com/users/\"</span> <span class=\"token operator\">+</span> username <span class=\"token operator\">+</span> <span class=\"token string\">\"/repos\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">reposError<span class=\"token punctuation\">,</span>\n    reposResponse<span class=\"token punctuation\">,</span>\n    repos</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    userRepos <span class=\"token operator\">=</span> repos<span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main repos\"</span><span class=\"token punctuation\">,</span> userRepos<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// future calculations or DOM manipulation</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Welcome to <a href=\"http://callbackhell.com/\">callback hell</a>.</p>\n<p>If you’ve ever code something similar to this, you feel the pain of not finding a way to reduce the nested blocks. If you’re like me, feeling icky to find a solution to end this monstrous bite to stop me from the Path towards Clean Code, you’ve probably used Promise to chain the callbacks by using <code class=\"language-text\">.then</code>.</p>\n<h2>Use Promise Chain for Consecutive Asynchronous Calls</h2>\n<p>Since few years ago, Promise has been the standard used in APIs provided by major library developers to an extend that it’s even harder to find libraries without returning a Promise by default. Requesting user data from Github is much easier with the use of <a href=\"https://github.com/octokit/rest.js/\">octokit rest client</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">octokit<span class=\"token punctuation\">.</span>users\n  <span class=\"token punctuation\">.</span><span class=\"token function\">getByUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    username\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"data\"</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setUser</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> octokit<span class=\"token punctuation\">.</span>repos<span class=\"token punctuation\">.</span><span class=\"token function\">listForUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      username\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setRepos</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setLoading</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Similar result can be obtained by using axios too, if using API client is not favorable due to certain reasons:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> user<span class=\"token punctuation\">,</span> repos<span class=\"token punctuation\">;</span>\naxios\n  <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    user <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/repos</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    repos <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Create a Promise Function</h2>\n<p>From the snippet above, <code class=\"language-text\">axios.get</code> is a function that returns a Promise object. A Promise object consists of a property named <code class=\"language-text\">then</code>, with a callback constructor that returns <code class=\"language-text\">resolve</code> and <code class=\"language-text\">reject</code>. </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> foo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Success!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As a rule of thumb, every Promise defined should have both <code class=\"language-text\">resolve</code> and <code class=\"language-text\">reject</code> being called. Typically <code class=\"language-text\">resolve</code> works like a function, while <code class=\"language-text\">reject</code> tells caller that something is wrong within the function.</p>\n<p>Let’s try re-implement the <code class=\"language-text\">getUser</code> function. This function does the same thing as <code class=\"language-text\">getUser</code> function we’ve seen earlier, with Promise implemented:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getUser</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">username</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://api.github.com/users/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>username<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> user<span class=\"token punctuation\">,</span> repos<span class=\"token punctuation\">;</span>\n    axios\n      <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        user <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/repos</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        repos <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">,</span> repos <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now we can call <code class=\"language-text\">getUser</code> function like how we use <code class=\"language-text\">then</code> previously:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getUser\"</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// output: getUser Object {user: Object, repos: Array[30]}</span></code></pre></div>\n<h2>Promise.all</h2>\n<p>Now we’re able to call <code class=\"language-text\">getUser</code> function to get both user profile and user repos. Experienced developers might noticed that Promise chain runs <em>linearly</em>. The API call to obtain user repositories only triggered after the first API call to get user profile, but the API to get user’s repositories doesn’t rely on what’s being returned from user profile! We can now improve the performance by calling both APIs asynchronously.\nThat means we’re going to separate both calls to different Promise calls.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> loadUser <span class=\"token operator\">=</span> octokit<span class=\"token punctuation\">.</span>users\n  <span class=\"token punctuation\">.</span><span class=\"token function\">getByUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    username\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setUser</span><span class=\"token punctuation\">(</span>loadUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> loadRepos <span class=\"token operator\">=</span> octokit<span class=\"token punctuation\">.</span>repos\n  <span class=\"token punctuation\">.</span><span class=\"token function\">listForUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    username\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setRepos</span><span class=\"token punctuation\">(</span>loadRepos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It looked syntactically correct, but now both calls are asynchronous without being controlled, which would easily obstruct the program flow in overall. You’ll need a manager to consolidate both calls to return data first before proceed. Let us hire <code class=\"language-text\">Promise.all</code> to do that.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> dataPromises <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  octokit<span class=\"token punctuation\">.</span>users<span class=\"token punctuation\">.</span><span class=\"token function\">getByUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    username\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  octokit<span class=\"token punctuation\">.</span>repos<span class=\"token punctuation\">.</span><span class=\"token function\">listForUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    username\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\nPromise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>dataPromises<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">allPromises</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>userCall<span class=\"token punctuation\">,</span> repoCall<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> allPromises<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setUser</span><span class=\"token punctuation\">(</span>userCall<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setRepos</span><span class=\"token punctuation\">(</span>repoCall<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setLoading</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">Promise.all</code> will make sure every async call is finished before resolving all promises into one single array consists of the resolved data of each async call following the order in <code class=\"language-text\">dataPromises</code> array.</p>\n<h2>Conclusion</h2>\n<p>There’s a deep knowledge of asynchronous programming in JavaScript which is available to <a href=\"https://eloquentjavascript.net/11_async.html\">read online for free</a>, and this blog post merely scratching the surface by introducing the practical application of Promise in our projects using Node.js or any modern JavaScript tools including frontend frameworks and libraries. Based on my personal experience, it is important to make sure every Promise is being handled, as a program might remain running indefinitely if the async calls are not being handled properly, and this is especially hard to debug if you have many async calls scattered across files within a project.</p>\n<p>By going through the improvements from a callback hell to using <code class=\"language-text\">Promise.all</code> to run two API calls asynchronously, hope this makes things clearer for you to understand how to utilize JavaScript Promise.</p>\n<h2>External Read and Resources</h2>\n<ol>\n<li><a href=\"https://medium.freecodecamp.org/how-to-make-a-promise-out-of-a-callback-function-in-javascript-d8ec35d1f981\">https://medium.freecodecamp.org/how-to-make-a-promise-out-of-a-callback-function-in-javascript-d8ec35d1f981</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then\">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then</a></li>\n<li><a href=\"https://eloquentjavascript.net/11_async.html\">https://eloquentjavascript.net/11_async.html</a></li>\n</ol>","frontmatter":{"title":"JavaScript Promise and Async / Await Part 1: Introduction to Promise","date":"May 22, 2019","description":""}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog/2019-05-22---introduction-to-promise/","previous":{"fields":{"slug":"/blog/2018-08-10---how-to-receive-emails-in-your-rails-application/"},"frontmatter":{"title":"How to Receive Emails in Your Rails Application"}},"next":null}}}